\documentclass[11pt,a4paper]{article}
\usepackage[margin=2.5cm]{geometry}
\usepackage{microtype}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{latexsym}
\usepackage{mathtools}
\usepackage{stmaryrd}
\usepackage{extarrows}
\usepackage{slashed}
\usepackage[colon]{natbib}
\usepackage{todonotes}
\usepackage[unicode=true,pdftex,pdfa]{hyperref}
\usepackage[capitalise,noabbrev,nameinlink]{cleveref}
\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}

%%
%% Package `semantic` can be used for writing inference rules.
%%
\usepackage{semantic}
%% Setup for the semantic package
\setpremisesspace{20pt}

\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\range}{range}

%%
%% TODO: we should package this
%%
\newcommand{\powerset}[1]{\mathbb{P}~#1}
\newcommand{\restrictdom}{\lhd}
\newcommand{\subtractdom}{\mathbin{\slashed{\restrictdom}}}
\newcommand{\restrictrange}{\rhd}
\newcommand{\union}{\cup}
\newcommand{\unionoverride}{\mathbin{\underrightarrow\cup}}
\newcommand{\uniondistinct}{\uplus}
\newcommand{\var}[1]{\mathit{#1}}
\newcommand{\fun}[1]{\mathsf{#1}}
\newcommand{\type}[1]{\mathsf{#1}}
\newcommand{\serialised}[1]{\llbracket #1 \rrbracket}
\newcommand{\signed}[2]{\llbracket #1 \rrbracket_{#2}}
\newcommand{\verified}[3]{\mathcal{V}_{#1}\llbracket #2 \rrbracket_{#3}}
\newcommand{\size}[1]{\left| #1 \right|}
\newcommand{\transitionarrow}[2]{\xlongrightarrow[\textsc{#1}]{#2}}
\newcommand{\listOf}[1]{#1^{*}}

%%
%% Functions
%%
\newcommand{\txins}[1]{\text{txins}\ \mathit{#1}}
\newcommand{\txouts}[1]{\text{txouts}\ \mathit{#1}}
\newcommand{\balance}[1]{\text{balance}\ \mathit{#1}}
\newcommand{\unspent}[1]{\text{unspent}\ \mathit{#1}}
\begin{document}

\title{Simplified Formal Specification of a UTxO Ledger}

\author{}

\date{September 24, 2018}

\begin{abstract}
Bleh.
\end{abstract}

\section{Introduction}
\label{sec:introduction}

This specification models the \textit{conditions} required for the extension of
a ledger, i.e. a list of transactions. The following aspects are part of such
conditions:

\begin{description}
\item[Balances] relationship between the total value of input and outputs
  in a new transaction, and the unspent outputs.
\item[Witnesses] cryptographic entities needed to validate the expenditure
  of a transaction input.
\item[Heavyweight-delegation] transfer of staking rights.
\item[Update validation] voting mechanism which captures the identification of
  the voters, and the participants that can post update proposals.
\end{description}

\section{Preliminaries}\label{sec:preliminaries}

TODO: explain  $\powerset{\type{X}}$, $\listOf{\type{X}}$, etc.


\section{Basic definitions}
\label{sec:basic-definitions}

\section{Auxiliary definitions}
\label{sec:auxil-defin}

\section{State transitions for UTxO}
\label{sec:state-trans-utxo-1}



\section{State transitions for basic UTxO transactions}
\label{sec:state-trans-basic}



\begin{figure}[h]

  \centering
  \begin{equation}\label{eq:utxo-base}
    \inference[UTxO-base]
    {}
    {\emptyset}
  \end{equation}
  
  \begin{equation}\label{eq:utxo-inductive}
    \inference[UTxO-inductive]
    { \txins{tx} \subseteq \mathit{u}
      & \balance{(\txouts{tx})} \leq \balance{(\txins{tx} \cap u)}
    }
    {u \transitionarrow{utxo}{tx} (u \setminus \txins{tx}) \cup \unspent{tx}}
  \end{equation}
  \caption{State transitions for UTxO transactions}
  \label{fig:state-trans-utxo}
\end{figure}

Rule~\ref{eq:utxo-base}

\section{State transitions for UTxO transactions with witnesses}
\label{sec:state-trans-utxo}

\section{Test}
\label{sec:test}

Delete this in due time....

\begin{figure}[h]

\emph{Primitive types}
%
\begin{equation*}
\begin{array}{r@{~\in~}lr}
  \var{txid}
& \type{TxId}
& \text{transaction id}
\\
  ix
& \type{Ix}
& \text{index}
\\
  \var{addr}
& \type{Addr}
& \text{address}
\\
  c
& \type{Coin}
& \text{currency value}
\end{array}
\end{equation*}
%
\emph{Derived types}
%
\begin{equation*}
\begin{array}{r@{~\in~}l@{\qquad=\qquad}r@{~\in~}lr}
  \var{tx}
& \type{Tx}
& (\var{inputs}, \var{outputs})
& \powerset{\type{TxIn}} \times (\type{Ix} \mapsto \type{TxOut})
& \text{transaction}
\\
  \var{txin}
& \type{TxIn}
& (\var{txid}, \var{ix})
& \type{TxId} \times \type{Ix}
& \text{transaction input}
\\
  \var{txout}
& \type{TxOut}
& (\var{addr}, c)
& \type{Addr} \times \type{Coin}
& \text{transaction output}
\\
  \var{utxo}
& \type{UTxO}
& \var{txin} \mapsto \var{txout}
& \type{TxIn} \mapsto \type{TxOut}
& \text{unspent tx outputs}
\end{array}
\end{equation*}
%
\emph{Functions}
%
\begin{equation*}
\begin{array}{lr}
  \fun{txid} \in \type{Tx} \to \type{TxId}
& \text{compute transaction id}
\end{array}
\end{equation*}

\caption{Basic Definitions}
\label{fig:basic_definitions}
\end{figure}


\begin{figure}


\begin{equation*}
\frac{
}{
\mathcal{G}_{\fun{utxo}}, \emptyset
}
\textsc{genesis}
\end{equation*}
%
\\[1em]
%
\begin{equation*}
\frac{
  \fun{txins} ~ \var{tx} \subseteq \var{utxo} \qquad
  \fun{balance}~(\fun{txouts}~\var{tx}) \leq \fun{balance}~(\fun{txins} ~ \var{tx} \restrictdom \var{utxo})
}{
  \begin{array}{r}
    \var{utxo} \\
    \Lambda
  \end{array}
  \transitionarrow{transaction}{\var{tx}}
  \begin{array}{l}
  (\fun{txins} ~ \var{tx} \subtractdom \var{utxo}) \union \fun{txouts}~\var{tx} \\
  \Lambda ; \var{tx}
  \end{array}
}
\end{equation*}

\caption{State transitions for transactions}
\label{fig:transaction_transitions}
\end{figure}



\end{document}
